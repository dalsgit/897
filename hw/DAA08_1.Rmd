---
title: "Stat 897 Fall 2017 Data Analysis Assignment 8"
author: "Penn State"
date: "Due October 22, 2017"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

In this assignment we again use the College data found in the ISLR library, with the 600 observation training set (using the rest as the test data).

### (a) Using out-of-state tuition as the response and the other variables as the predictors, perform forward stepwise selection on the training set in order to identify a satisfactory model that uses just a subset of the predictors. Please set the seed at 801 once at the beginning before choosing the training set.

```{r}
library(ISLR)
library(leaps)
library(gam)

data("College")
attach(College)
set.seed (801)
trainingRows=sample (nrow(College), 600, replace = FALSE)
train = College[trainingRows,]
test = College[-trainingRows,]

regfit.fwd=regsubsets (Outstate~.,data=train, nvmax =17, method='forward')
reg.summary = summary (regfit.fwd)
plot(reg.summary$bic, xlab ="Number of Variables",ylab="BIC", type = 'l', main = 'Forward Step - Performance Measure')
which.min (reg.summary$bic )
points (which.min (reg.summary$bic ), reg.summary$bic[which.min (reg.summary$bic )], col ="red",cex =2, pch =20)

plot(reg.summary$cp, xlab ="Number of Variables",ylab="cp", type = 'l', main = 'Forward Step - Performance Measure')
which.min (reg.summary$cp )
points (which.min (reg.summary$cp ), reg.summary$cp[which.min (reg.summary$cp )], col ="red",cex =2, pch =20)

# Get the test MSE
test.mat=model.matrix (Outstate~.,data=test)
coefi=coef(regfit.fwd, id=which.min (reg.summary$cp ))
pred=test.mat [,names(coefi)] %*% coefi
testMSE = mean(( test$Apps-pred)^2)
testMSE

names(coefi)
# PrivateYes, Apps, Accept, Top25perc, F.Undergrad, Room.Board, Books, Personal, Terminal, S.F.Ratio, perc.alumni, Expend, Grad.Rate
```

### (b)  Fit a GAM on the training data, using out-of-state tuition as the response and the features selected in the previous step as the predictors. Use appropriate nonlinear components (e.g. natural splines, step functions) for the variables that need it as in the salary example from the book.  Plot the results, and explain your findings.   What nonlinear components did you use?

```{r}
fit <- gam(Outstate ~ Private + s( Apps, df = 2) + s( Accept, df = 2) + s( Top25perc, df = 2) + s( F.Undergrad, df = 2) + s( Room.Board, df = 2) + s( Books, df = 2) + s( Personal, df = 2) + s( Terminal, df = 2) + s( S.F.Ratio, df = 2) + s( perc.alumni, df = 2) + s( Expend, df = 2) + s( Grad.Rate, df = 2), data=train)
par(mfrow = c(2, 3))
plot(fit, se = T, col = "blue")
```

### (c) Evaluate both models obtained from part (a) and (b) on the test set, and explain the results obtained.

```{r}
preds <- predict(fit, College.test)
err <- mean((College.test$Outstate - preds)^2)
err
tss <- mean((College.test$Outstate - mean(College.test$Outstate))^2)
rss <- 1 - err / tss
rss
```

### (d) For which variables, if any, is there evidence of a non-linear relationship with the response?
